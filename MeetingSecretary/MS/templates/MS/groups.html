{% extends 'MS/base.html' %}
{% load i18n staticfiles %}

{% block title %}Groups{% endblock %}
{% block extra_head %}
<script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-3.2.0.min.js"></script>
{% endblock %}

{% block content %}
<h2></h2>
  <h3>User Information</h3>
name:       {{user.username}} <br>
first name: {{user.first_name}} <br>
last name:  {{user.last_name}} <br>
email:      {{user.email}} <br>

<h4>Administrator: </h4>
<p>Members: </p>
<ol>
</ol>
<form id = "addnewmember" method = "POST">
	{% csrf_token %}
<input type="text" id = "newmembername">
<input type="submit" value = "add a member">
</form>
<form id = "deletemember" method = "POST">
	{% csrf_token %}
<input type="text" id = "deletename">
<input type="submit" value = "delete a member">
</form>   
<script>
$(document).ready(function(){
		var url = window.location.href;
		var index = url.indexOf("groups") + 7;
		var group_name = url.substring(index);
		$("h2").append("<h2>" + group_name + "</h2>");
		$.ajax({
			type: 'POST',
			url: '/ajax/showgroup/',
			data: {group_name, csrfmiddlewaretoken:'{{ csrf_token}}'},
			dataType: 'json',
			success: function(data){
				$("h4").append(data['admin']);
				var count = data['member'].length;
				for (var i = 0; i < count; ++i)
					$("ol").append("<li>" + data['member'][i]+ 
					"<button type='button'" + "onclick = deletemember('" + data[i] + "')" 
					+ "value = " + "'"+ data[i] + "'"
					+ "id = " + "'member"+ data[i] + "'"
					+">delete</button>"+"</li>");
				//删除还没实现 想看看有没有合适的前端框架比较直接可以传递这个数据
					//alert(data[i]['group_name']);
			}
		});
	});


</script>

<script>
		$("#addnewmember").submit(function(event){
			event.preventDefault();
			var memberid = document.getElementById('newmembername').value;
			var url = window.location.href;
			var index = url.indexOf("groups") + 7;
			var group_name = url.substring(index);
			alert(memberid);
			$.ajax({
				type: "POST",
				url: "/ajax/addnewmember/",
				data: {memberid,group_name,csrfmiddlewaretoken: '{{ csrf_token }}'},
				dataType:'json',
				success:function(data){
					alert("User "+ memberid + " has been added to group " + group_name + "! Please refresh the page to see your group.");
				}
			});
		});

		$("#deletemember").submit(function(event){
			event.preventDefault();
			var memberid = document.getElementById('deletename').value;
			var url = window.location.href;
			var index = url.indexOf("groups") + 7;
			var group_name = url.substring(index);
			$.ajax({
				type: "POST",
				url: "/ajax/deletemember/",
				data: {memberid,group_name,csrfmiddlewaretoken: '{{ csrf_token }}'},
				dataType:'json',
				success:function(){
					alert("User "+ memberid + " has been removed from group " + group_name + "! Please refresh the page to see your group.");
				}
			});
		});
</script>
{% endblock %}

{% block footer%}
<a href="{% url 'home' %}">home</a>
{% endblock %}